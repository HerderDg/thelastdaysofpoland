on_actions = {
	on_capitulation = {
		effect = {
			set_global_flag = announce_peace
			FROM = {
				save_global_event_target_as = winning_country
			} 
			ROOT = {
				save_global_event_target_as = losing_country
			}
			if = {
				limit = {
					event_target:losing_country = {
						any_allied_country = {
							has_war_together_with = event_target:losing_country
						}
					}
				}
				set_global_flag = losing_country_multiple
			}

			if = {
				limit = {
					event_target:winning_country = {
						any_allied_country = {
							has_war_together_with = event_target:winning_country
						}
					}
				}
				set_global_flag = winning_country_multiple
			}
			add_to_variable = { global.peace_popup_dirty = 1 }			
				if = {
					limit = {
						ROOT = {
							original_tag = SKW
						}
						FROM = {
							OR = {
								original_tag = HOR
							}
						}
					}

					FROM = {
						white_peace = ROOT
						ZAW = {
							transfer_state = 740
						}
					}
					set_global_flag = skip_default_capitulation
				}
				if = {
					limit = {
						ROOT = {
							original_tag = BOH
						}
						FROM = {
							OR = {
								original_tag = UMN
								original_tag = TRN
							}
						}
					}

					FROM = {
						white_peace = ROOT
						UMN = {
							transfer_state = 505
							transfer_state = 824
						}
						TRN = {
							transfer_state = 495
							transfer_state = 823
						}
					}
					set_global_flag = skip_default_capitulation
				}
			if = {	
				limit = {
					OR = {
						ROOT = { is_in_faction = no }
						ROOT = {
							all_allied_country = {
								has_capitulated = yes
							}
						}
					}
				}
				set_global_flag = war_won
				set_global_flag = skip_default_capitulation
				FROM = {
					white_peace = ROOT
					annex_country = {
						target = ROOT
						transfer_troops = no
					}
				}
			}
			if = {
					limit = {
						ROOT = {
							original_tag = TOU
						}
						FROM = {
							OR = {
								original_tag = EKS
								original_tag = KGH
							}
						}
					}

					FROM = {
						white_peace = ROOT
						if = { limit = { country_exists = EKS } 
							annex_country = {
							target = TOU
							transfer_troops = yes
							}
						}
						if = { limit = { country_exists = KGH } 
							annex_country = {
							target = TOU
							transfer_troops = yes
							}
						}
						TOU = {
							transfer_state = 728
							transfer_state = 401
							transfer_state = 407
						}
					}
					set_global_flag = skip_default_capitulation
			}
		}
	}
}