on_actions = {
	on_capitulation = {
		effect = {
			set_global_flag = announce_peace
			FROM = {
				save_global_event_target_as = winning_country
			} 
			ROOT = {
				save_global_event_target_as = losing_country
			}
			if = {
				limit = {
					event_target:losing_country = {
						any_allied_country = {
							has_war_together_with = event_target:losing_country
						}
					}
				}
				set_global_flag = losing_country_multiple
			}

			if = {
				limit = {
					event_target:winning_country = {
						any_allied_country = {
							has_war_together_with = event_target:winning_country
						}
					}
				}
				set_global_flag = winning_country_multiple
			}
			add_to_variable = { global.peace_popup_dirty = 1 }			
				if = {
					limit = {
						ROOT = {
							original_tag = KES
						}
						FROM = {
							OR = {
								original_tag = CAL
								original_tag = FEL
							}
						}
					}

					FROM = {
						white_peace = ROOT
						CAL = {
							transfer_state = 342
							transfer_state = 359
							transfer_state = 337
							transfer_state = 335
							transfer_state = 311
							transfer_state = 851
							transfer_state = 285
						}
						FEL = {
							transfer_state = 257
							transfer_state = 843
							transfer_state = 271
							transfer_state = 298
							transfer_state = 320
							transfer_state = 274
							transfer_state = 292
						}
					}
					set_global_flag = skip_default_capitulation
				}
				if = {
					limit = {
						ROOT = {
							original_tag = BOH
						}
						FROM = {
							OR = {
								original_tag = UMN
								original_tag = TRN
							}
						}
					}

					FROM = {
						white_peace = ROOT
						UMN = {
							transfer_state = 505
							transfer_state = 824
						}
						TRN = {
							transfer_state = 495
							transfer_state = 823
						}
					}
					set_global_flag = skip_default_capitulation
				}
				if = {
					limit = {
						ROOT = {
							original_tag = HMA
						}
						FROM = {
							OR = {
								original_tag = BEL
								original_tag = LMZ
							}
						}
					}

					FROM = {
						white_peace = ROOT
						LMZ = {
							transfer_state = 149
						}
						BEL = {
							transfer_state = 831
						}
					}
					set_global_flag = skip_default_capitulation
				}
			if = {	
				limit = {
					OR = {
						ROOT = { is_in_faction = no }
						ROOT = {
							all_allied_country = {
								has_capitulated = yes
							}
						}
					}
				}
				set_global_flag = war_won
				set_global_flag = skip_default_capitulation
				FROM = {
					white_peace = ROOT
					annex_country = {
						target = ROOT
						transfer_troops = no
					}
				}
			}
		}
	}
}