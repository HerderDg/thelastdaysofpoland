lower_the_rations = {
	if = {
		limit = {
			has_idea = diet_full_calories
		}
		add_ideas = diet_no_limits
	}
	else_if = {
		limit = {
			has_idea = diet_no_limits
		}
		add_ideas = diet_rationing
	}
	else_if = {
		limit = {
			has_idea = diet_rationing
		}
		add_ideas = diet_hunger
	}
	else_if = {
		limit = {
			has_idea = diet_hunger
		}
		add_ideas = diet_holodomor
	}
	calculate_used_food = yes
}



calculate_food_balance = {
	calculate_used_food = yes
	set_variable = { current_food_balance = 0 }
	add_to_variable = { current_food_balance = resource@food }
}


calculate_used_food = {
	set_variable = { used_food = max_manpower_k	}
	divide_variable = { used_food = 10 }
	if = {
		limit = {
			OR = {
			has_idea = diet_hunger
			has_idea = diet_holodomor
			}
		}
		set_variable = { used_food_modifier = 0.25 }
		multiply_variable = {
			used_food = used_food_modifier
		}
	}
	if = {
		limit = {
			has_idea = diet_rationing
		}
		set_variable = { used_food_modifier = 0.5 }
		multiply_variable = {
			used_food = used_food_modifier
		}
	}
	if = {
		limit = {
			has_idea = diet_no_limits
		}
		set_variable = { used_food_modifier = 1 }
		multiply_variable = {
			used_food = used_food_modifier
		}
	}
	if = {
		limit = {
			has_idea = diet_full_calories
		}
		set_variable = { used_food_modifier = 1.5 }
		multiply_variable = {
			used_food = used_food_modifier
		}
	}
	if = {
		limit = {
			has_idea = diet_meat
		}
		set_variable = { used_food_modifier = 1.25 }
		multiply_variable = {
			used_food = used_food_modifier
		}
	}
	if = {
		limit = {
			has_idea = diet_vegetarian
		}
		set_variable = { used_food_modifier = 0.8 }
		multiply_variable = {
			used_food = used_food_modifier
		}
	}	
	if = {
		limit = {
			has_idea = diet_vegan
		}
		set_variable = { used_food_modifier = 0.8 }
		multiply_variable = {
			used_food = used_food_modifier
		}
	}
	round_variable = used_food	
	add_dynamic_modifier = {
		modifier = food_consumed_modifier
	}
}

calculate_food_effects = {
	if = {
		limit = {
			check_variable = { current_food_balance < 0 }
			OR = {
				has_idea = diet_full_calories
				has_idea = diet_no_limits
				has_idea = diet_rationing
				has_idea = diet_hunger
			}
		}
		lower_the_rations = yes
		calculate_used_food = yes
	}
}