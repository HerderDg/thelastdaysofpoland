
# tba

CAL_redraw_senate_diagram = {
	set_variable = {
		CAL_populares_percentage = CAL_populares_count
	}
	set_variable = {
		CAL_populares_at_row1 = 0
	}
	set_variable = {
		CAL_populares_at_row2 = 0
	}
	set_variable = {
		CAL_populares_at_row3 = 0
	}
	set_variable = {
		CAL_populares_at_row4 = 0
	}
	set_variable = {
		CAL_populares_at_row5 = 0
	}
	set_variable = {
		CAL_populares_at_row6 = 0
	}
	set_variable = {
		CAL_populares_at_row7 = 0
	}
	set_variable = {
		CAL_populares_at_row8 = 0
	}
	set_variable = {
		CAL_populares_at_row9 = 0
	}
	set_variable = {
		CAL_populares_at_row10 = 0
	}
	set_variable = {
		CAL_populares_at_row11 = 0
	}
	set_variable = {
		CAL_populares_at_row12 = 0
	}
	set_variable = {
		CAL_populares_at_row13 = 0
	}
	set_variable = {
		CAL_populares_at_row14 = 0
	}
	set_variable = {
		CAL_populares_at_row15 = 0
	}
	set_variable = {
		CAL_populares_at_row16 = 0
	}
	set_variable = {
		CAL_populares_at_row17 = 0
	}
	set_variable = {
		CAL_populares_at_row18 = 0
	}
	set_variable = {
		CAL_populares_at_row19 = 0
	}
	if = {
		limit = {
			check_variable = {
				CAL_senate_lvl = 1
			}
		}
		divide_variable = {
			CAL_populares_percentage = 100
		}
	}
	else_if = {
		limit = {
			check_variable = {
				CAL_senate_lvl = 2
			}
		}
		divide_variable = {
			CAL_populares_percentage = 150
		}
	}
	else_if = {
		limit = {
			check_variable = {
				CAL_senate_lvl = 3
			}
		}
		divide_variable = {
			CAL_populares_percentage = 300
		}
	}
	else = {
		divide_variable = {
			CAL_populares_percentage = 900
		}
	}
	set_variable = {
		CAL_seats_to_draw = CAL_populares_count
	}
	#drawing
	#round 1
	set_variable = {
		CAL_seats_to_draw_this_round = CAL_populares_percentage
	}
	multiply_variable = {
		CAL_seats_to_draw_this_round = 20
	}
	round_variable = CAL_seats_to_draw_this_round
	if = {
		limit = { 
			check_variable = { CAL_seats_to_draw_this_round = 0 }
			check_variable = { CAL_populares_count > 0 }
		}
		set_variable = {
			CAL_seats_to_draw_this_round = 1
		}
	}
	set_variable = {CAL_populares_at_row1 = CAL_seats_to_draw_this_round}
	subtract_from_variable = { CAL_seats_to_draw = CAL_populares_at_row1}
	#ROUND 2
	if = {
		limit = {
			check_variable = {
				CAL_seats_to_draw > 0 
			}
		}
		set_variable = {
			CAL_seats_to_draw_this_round = CAL_populares_percentage
		}
		multiply_variable = {
			CAL_seats_to_draw_this_round = 23
		}
		round_variable = CAL_seats_to_draw_this_round
		if = {
			limit = { 
				check_variable = { CAL_seats_to_draw_this_round = 0 }

			}
			set_variable = {
				CAL_seats_to_draw_this_round = 1
			}
		}
		set_variable = {CAL_populares_at_row2 = CAL_seats_to_draw_this_round}
		subtract_from_variable = { CAL_seats_to_draw = CAL_populares_at_row2}
	}
	#ROUND 3
	if = {
		limit = {
			check_variable = {
				CAL_seats_to_draw > 0 
			}
		}
		set_variable = {
			CAL_seats_to_draw_this_round = CAL_populares_percentage
		}
		multiply_variable = {
			CAL_seats_to_draw_this_round = 26
		}
		round_variable = CAL_seats_to_draw_this_round
		if = {
			limit = { 
				check_variable = { CAL_seats_to_draw_this_round = 0 }

			}
			set_variable = {
				CAL_seats_to_draw_this_round = 1
			}
		}
		set_variable = {CAL_populares_at_row3 = CAL_seats_to_draw_this_round}
		subtract_from_variable = { CAL_seats_to_draw = CAL_populares_at_row3}
	}
	#ROUND 4
	if = {
		limit = {
			check_variable = {
				CAL_seats_to_draw > 0 
			}
		}
		set_variable = {
			CAL_seats_to_draw_this_round = CAL_populares_percentage
		}
		multiply_variable = {
			CAL_seats_to_draw_this_round = 29
		}
		round_variable = CAL_seats_to_draw_this_round
		if = {
			limit = { 
				check_variable = { CAL_seats_to_draw_this_round = 0 }
			}
			set_variable = {
				CAL_seats_to_draw_this_round = 1
			}
		}
		if = {
			limit = {
				check_variable = {
					CAL_seats_to_draw < CAL_seats_to_draw_this_round
				}
			}
			set_variable = {CAL_seats_to_draw_this_round = CAL_seats_to_draw}
		}
		set_variable = {CAL_populares_at_row4 = CAL_seats_to_draw_this_round}
		subtract_from_variable = { CAL_seats_to_draw = CAL_populares_at_row4}
	}
	#ROUND 5
	if = {
		limit = {
			check_variable = {
				CAL_seats_to_draw > 0 
			}
		}
		set_variable = {
			CAL_seats_to_draw_this_round = CAL_populares_percentage
		}
		if = {
			limit = {
				check_variable = {
					CAL_senate_lvl = 1
				}
			}
			multiply_variable = {
				CAL_seats_to_draw_this_round = 2
			}
		}
		else = {
			multiply_variable = {
				CAL_seats_to_draw_this_round = 32
			}
		}
		round_variable = CAL_seats_to_draw_this_round
		if = {
			limit = { 
				check_variable = { CAL_seats_to_draw_this_round = 0 }
			}
			set_variable = {
				CAL_seats_to_draw_this_round = 1
			}
		}
		if = {
			limit = {
				check_variable = {
					CAL_seats_to_draw < CAL_seats_to_draw_this_round
				}
			}
			set_variable = {CAL_seats_to_draw_this_round = CAL_seats_to_draw}
		}
		set_variable = {CAL_populares_at_row5 = CAL_seats_to_draw_this_round}
		subtract_from_variable = { CAL_seats_to_draw = CAL_populares_at_row5}
	}
	#bonus round for lvl 1
	if = {
		limit = {
			check_variable = { CAL_senate_lvl = 1 }
			check_variable = { CAL_seats_to_draw > 0}
		}
		while_loop_effect = {
			limit = {
				check_variable = { CAL_seats_to_draw > 0 }
			}
			if = {
				limit = {
					check_variable = {CAL_populares_at_row5 < 2 }
				}
				add_to_variable = { CAL_populares_at_row5 = 1}
			}
			else_if = {
				limit = {
					check_variable = {CAL_populares_at_row4 < 29 }
				}
				add_to_variable = { CAL_populares_at_row4 = 1}
			}
			subtract_from_variable = { CAL_seats_to_draw = 1 }
		}
	}
	if = {
		limit = {
			check_variable = {
				CAL_seats_to_draw > 0 
			}
		}
		set_variable = {
			CAL_seats_to_draw_this_round = CAL_populares_percentage
		}
		if = {
			limit = {
				check_variable = {
					CAL_senate_lvl = 2
				}
			}
			multiply_variable = {
				CAL_seats_to_draw_this_round = 20
			}
		}
		else = {
			multiply_variable = {
				CAL_seats_to_draw_this_round = 35
			}
		}
		round_variable = CAL_seats_to_draw_this_round
		if = {
			limit = { 
				check_variable = { CAL_seats_to_draw_this_round = 0 }
			}
			set_variable = {
				CAL_seats_to_draw_this_round = 1
			}
		}
		if = {
			limit = {
				check_variable = {
					CAL_seats_to_draw < CAL_seats_to_draw_this_round
				}
			}
			set_variable = {CAL_seats_to_draw_this_round = CAL_seats_to_draw}
		}
		set_variable = {CAL_populares_at_row6 = CAL_seats_to_draw_this_round}
		subtract_from_variable = { CAL_seats_to_draw = CAL_populares_at_row6}
	}
	#another bonus round (for lvl 2)
	if = {
		limit = {
			check_variable = { CAL_senate_lvl = 2 }
			check_variable = { CAL_seats_to_draw > 0}
		}
		while_loop_effect = {
			limit = {
				check_variable = { CAL_seats_to_draw > 0 }
			}
			if = {
				limit = {
					check_variable = {CAL_populares_at_row6 < 20 }
				}
				add_to_variable = { CAL_populares_at_row6 = 1}
			}
			else_if = {
				limit = {
					check_variable = {CAL_populares_at_row5 < 32 }
				}
				add_to_variable = { CAL_populares_at_row5 = 1}
			}
			subtract_from_variable = { CAL_seats_to_draw = 1 }
		}
	}
	#round 7
	if = {
		limit = {
			check_variable = {
				CAL_seats_to_draw > 0 
			}
		}
		set_variable = {
			CAL_seats_to_draw_this_round = CAL_populares_percentage
		}
		multiply_variable = {
			CAL_seats_to_draw_this_round = 39
		}
		round_variable = CAL_seats_to_draw_this_round
		if = {
			limit = { 
				check_variable = { CAL_seats_to_draw_this_round = 0 }
			}
			set_variable = {
				CAL_seats_to_draw_this_round = 1
			}
		}
		if = {
			limit = {
				check_variable = {
					CAL_seats_to_draw < CAL_seats_to_draw_this_round
				}
			}
			set_variable = {CAL_seats_to_draw_this_round = CAL_seats_to_draw}
		}
		set_variable = {CAL_populares_at_row7 = CAL_seats_to_draw_this_round}
		subtract_from_variable = { CAL_seats_to_draw = CAL_populares_at_row7}
	}
	#round 8
	if = {
		limit = {
			check_variable = {
				CAL_seats_to_draw > 0 
			}
		}
		set_variable = {
			CAL_seats_to_draw_this_round = CAL_populares_percentage
		}
		multiply_variable = {
			CAL_seats_to_draw_this_round = 42
		}
		round_variable = CAL_seats_to_draw_this_round
		if = {
			limit = { 
				check_variable = { CAL_seats_to_draw_this_round = 0 }
			}
			set_variable = {
				CAL_seats_to_draw_this_round = 1
			}
		}
		if = {
			limit = {
				check_variable = {
					CAL_seats_to_draw < CAL_seats_to_draw_this_round
				}
			}
			set_variable = {CAL_seats_to_draw_this_round = CAL_seats_to_draw}
		}
		set_variable = {CAL_populares_at_row8 = CAL_seats_to_draw_this_round}
		subtract_from_variable = { CAL_seats_to_draw = CAL_populares_at_row8}
	}
	#round 9
	if = {
		limit = {
			check_variable = {
				CAL_seats_to_draw > 0 
			}
		}
		set_variable = {
			CAL_seats_to_draw_this_round = CAL_populares_percentage
		}
		multiply_variable = {
			CAL_seats_to_draw_this_round = 45
		}
		round_variable = CAL_seats_to_draw_this_round
		if = {
			limit = { 
				check_variable = { CAL_seats_to_draw_this_round = 0 }
			}
			set_variable = {
				CAL_seats_to_draw_this_round = 1
			}
		}
		if = {
			limit = {
				check_variable = {
					CAL_seats_to_draw < CAL_seats_to_draw_this_round
				}
			}
			set_variable = {CAL_seats_to_draw_this_round = CAL_seats_to_draw}
		}
		set_variable = {CAL_populares_at_row9 = CAL_seats_to_draw_this_round}
		subtract_from_variable = { CAL_seats_to_draw = CAL_populares_at_row9}
	}
	#round 10
	if = {
		limit = {
			check_variable = {
				CAL_seats_to_draw > 0 
			}
		}
		set_variable = {
			CAL_seats_to_draw_this_round = CAL_populares_percentage
		}
		if = {
			limit = {
				check_variable = {
					CAL_senate_lvl = 3
				}
			}
			multiply_variable = {
				CAL_seats_to_draw_this_round = 9
			}
		}
		else = {
			multiply_variable = {
				CAL_seats_to_draw_this_round = 48
			}
		}
		round_variable = CAL_seats_to_draw_this_round
		if = {
			limit = { 
				check_variable = { CAL_seats_to_draw_this_round = 0 }
			}
			set_variable = {
				CAL_seats_to_draw_this_round = 1
			}
		}
		if = {
			limit = {
				check_variable = {
					CAL_seats_to_draw < CAL_seats_to_draw_this_round
				}
			}
			set_variable = {CAL_seats_to_draw_this_round = CAL_seats_to_draw}
		}
		set_variable = {CAL_populares_at_row10 = CAL_seats_to_draw_this_round}
		subtract_from_variable = { CAL_seats_to_draw = CAL_populares_at_row10}
	}
	#another bonus round (for lvl 3)
	if = {
		limit = {
			check_variable = { CAL_senate_lvl = 3 }
			check_variable = { CAL_seats_to_draw > 0}
		}
		while_loop_effect = {
			limit = {
				check_variable = { CAL_seats_to_draw > 0 }
			}
			if = {
				limit = {
					check_variable = {CAL_populares_at_row10 < 20 }
				}
				add_to_variable = { CAL_populares_at_row10 = 1}
			}
			subtract_from_variable = { CAL_seats_to_draw = 1 }
		}
	}
	#round 11
	if = {
		limit = {
			check_variable = {
				CAL_seats_to_draw > 0 
			}
		}
		set_variable = {
			CAL_seats_to_draw_this_round = CAL_populares_percentage
		}
		multiply_variable = {
			CAL_seats_to_draw_this_round = 51
		}
		round_variable = CAL_seats_to_draw_this_round
		if = {
			limit = { 
				check_variable = { CAL_seats_to_draw_this_round = 0 }
			}
			set_variable = {
				CAL_seats_to_draw_this_round = 1
			}
		}
		if = {
			limit = {
				check_variable = {
					CAL_seats_to_draw < CAL_seats_to_draw_this_round
				}
			}
			set_variable = {CAL_seats_to_draw_this_round = CAL_seats_to_draw}
		}
		set_variable = {CAL_populares_at_row11 = CAL_seats_to_draw_this_round}
		subtract_from_variable = { CAL_seats_to_draw = CAL_populares_at_row11}
	}
	#round 12
	if = {
		limit = {
			check_variable = {
				CAL_seats_to_draw > 0 
			}
		}
		set_variable = {
			CAL_seats_to_draw_this_round = CAL_populares_percentage
		}
		multiply_variable = {
			CAL_seats_to_draw_this_round = 54
		}
		round_variable = CAL_seats_to_draw_this_round
		if = {
			limit = { 
				check_variable = { CAL_seats_to_draw_this_round = 0 }
			}
			set_variable = {
				CAL_seats_to_draw_this_round = 1
			}
		}
		if = {
			limit = {
				check_variable = {
					CAL_seats_to_draw < CAL_seats_to_draw_this_round
				}
			}
			set_variable = {CAL_seats_to_draw_this_round = CAL_seats_to_draw}
		}
		set_variable = {CAL_populares_at_row12 = CAL_seats_to_draw_this_round}
		subtract_from_variable = { CAL_seats_to_draw = CAL_populares_at_row12}
	}
	#round 13
	if = {
		limit = {
			check_variable = {
				CAL_seats_to_draw > 0 
			}
		}
		set_variable = {
			CAL_seats_to_draw_this_round = CAL_populares_percentage
		}
		multiply_variable = {
			CAL_seats_to_draw_this_round = 57
		}
		round_variable = CAL_seats_to_draw_this_round
		if = {
			limit = { 
				check_variable = { CAL_seats_to_draw_this_round = 0 }
			}
			set_variable = {
				CAL_seats_to_draw_this_round = 1
			}
		}
		if = {
			limit = {
				check_variable = {
					CAL_seats_to_draw < CAL_seats_to_draw_this_round
				}
			}
			set_variable = {CAL_seats_to_draw_this_round = CAL_seats_to_draw}
		}
		set_variable = {CAL_populares_at_row13 = CAL_seats_to_draw_this_round}
		subtract_from_variable = { CAL_seats_to_draw = CAL_populares_at_row13}
	}
	#round 14
	if = {
		limit = {
			check_variable = {
				CAL_seats_to_draw > 0 
			}
		}
		set_variable = {
			CAL_seats_to_draw_this_round = CAL_populares_percentage
		}
		multiply_variable = {
			CAL_seats_to_draw_this_round = 61
		}
		round_variable = CAL_seats_to_draw_this_round
		if = {
			limit = { 
				check_variable = { CAL_seats_to_draw_this_round = 0 }
			}
			set_variable = {
				CAL_seats_to_draw_this_round = 1
			}
		}
		if = {
			limit = {
				check_variable = {
					CAL_seats_to_draw < CAL_seats_to_draw_this_round
				}
			}
			set_variable = {CAL_seats_to_draw_this_round = CAL_seats_to_draw}
		}
		set_variable = {CAL_populares_at_row14 = CAL_seats_to_draw_this_round}
		subtract_from_variable = { CAL_seats_to_draw = CAL_populares_at_row14}
	}
	#round 15
	if = {
		limit = {
			check_variable = {
				CAL_seats_to_draw > 0 
			}
		}
		set_variable = {
			CAL_seats_to_draw_this_round = CAL_populares_percentage
		}
		multiply_variable = {
			CAL_seats_to_draw_this_round = 64
		}
		round_variable = CAL_seats_to_draw_this_round
		if = {
			limit = { 
				check_variable = { CAL_seats_to_draw_this_round = 0 }
			}
			set_variable = {
				CAL_seats_to_draw_this_round = 1
			}
		}
		if = {
			limit = {
				check_variable = {
					CAL_seats_to_draw < CAL_seats_to_draw_this_round
				}
			}
			set_variable = {CAL_seats_to_draw_this_round = CAL_seats_to_draw}
		}
		set_variable = {CAL_populares_at_row15 = CAL_seats_to_draw_this_round}
		subtract_from_variable = { CAL_seats_to_draw = CAL_populares_at_row15}
	}
	#round 16
	if = {
		limit = {
			check_variable = {
				CAL_seats_to_draw > 0 
			}
		}
		set_variable = {
			CAL_seats_to_draw_this_round = CAL_populares_percentage
		}
		multiply_variable = {
			CAL_seats_to_draw_this_round = 67
		}
		round_variable = CAL_seats_to_draw_this_round
		if = {
			limit = { 
				check_variable = { CAL_seats_to_draw_this_round = 0 }
			}
			set_variable = {
				CAL_seats_to_draw_this_round = 1
			}
		}
		if = {
			limit = {
				check_variable = {
					CAL_seats_to_draw < CAL_seats_to_draw_this_round
				}
			}
			set_variable = {CAL_seats_to_draw_this_round = CAL_seats_to_draw}
		}
		set_variable = {CAL_populares_at_row16 = CAL_seats_to_draw_this_round}
		subtract_from_variable = { CAL_seats_to_draw = CAL_populares_at_row16}
	}
	#round 17
	if = {
		limit = {
			check_variable = {
				CAL_seats_to_draw > 0 
			}
		}
		set_variable = {
			CAL_seats_to_draw_this_round = CAL_populares_percentage
		}
		multiply_variable = {
			CAL_seats_to_draw_this_round = 70
		}
		round_variable = CAL_seats_to_draw_this_round
		if = {
			limit = { 
				check_variable = { CAL_seats_to_draw_this_round = 0 }
			}
			set_variable = {
				CAL_seats_to_draw_this_round = 1
			}
		}
		if = {
			limit = {
				check_variable = {
					CAL_seats_to_draw < CAL_seats_to_draw_this_round
				}
			}
			set_variable = {CAL_seats_to_draw_this_round = CAL_seats_to_draw}
		}
		set_variable = {CAL_populares_at_row17 = CAL_seats_to_draw_this_round}
		subtract_from_variable = { CAL_seats_to_draw = CAL_populares_at_row17}
	}
	#round 18
	if = {
		limit = {
			check_variable = {
				CAL_seats_to_draw > 0 
			}
		}
		set_variable = {
			CAL_seats_to_draw_this_round = CAL_populares_percentage
		}
		multiply_variable = {
			CAL_seats_to_draw_this_round = 73
		}
		round_variable = CAL_seats_to_draw_this_round
		if = {
			limit = { 
				check_variable = { CAL_seats_to_draw_this_round = 0 }
			}
			set_variable = {
				CAL_seats_to_draw_this_round = 1
			}
		}
		if = {
			limit = {
				check_variable = {
					CAL_seats_to_draw < CAL_seats_to_draw_this_round
				}
			}
			set_variable = {CAL_seats_to_draw_this_round = CAL_seats_to_draw}
		}
		set_variable = {CAL_populares_at_row18 = CAL_seats_to_draw_this_round}
		subtract_from_variable = { CAL_seats_to_draw = CAL_populares_at_row18}
	}
	#round 19
	if = {
		limit = {
			check_variable = {
				CAL_seats_to_draw > 0 
			}
		}
		set_variable = {
			CAL_seats_to_draw_this_round = CAL_populares_percentage
		}
		multiply_variable = {
			CAL_seats_to_draw_this_round = 64
		}
		round_variable = CAL_seats_to_draw_this_round
		if = {
			limit = { 
				check_variable = { CAL_seats_to_draw_this_round = 0 }
			}
			set_variable = {
				CAL_seats_to_draw_this_round = 1
			}
		}
		if = {
			limit = {
				check_variable = {
					CAL_seats_to_draw < CAL_seats_to_draw_this_round
				}
			}
			set_variable = {CAL_seats_to_draw_this_round = CAL_seats_to_draw}
		}
		set_variable = {CAL_populares_at_row19 = CAL_seats_to_draw_this_round}
		subtract_from_variable = { CAL_seats_to_draw = CAL_populares_at_row19}
	}
	#last level, last bonus round
	if = {
		limit = {
			check_variable = { CAL_senate_lvl = 4 }
			check_variable = { CAL_seats_to_draw > 0}
		}
		while_loop_effect = {
			limit = {
				check_variable = { CAL_seats_to_draw > 0 }
			}
			if = {
				limit = {
					check_variable = {CAL_populares_at_row19 < 64 }
				}
				add_to_variable = { CAL_populares_at_row19 = 1}
			}
			else_if = {
				limit = {
					check_variable = {CAL_populares_at_row18 < 73 }
				}
				add_to_variable = { CAL_populares_at_row18 = 1}
			}
			subtract_from_variable = { CAL_seats_to_draw = 1 }
		}
	}
	set_variable = { CAL_seats_drawn = CAL_populares_at_row1 }
	add_to_variable = { CAL_seats_drawn	= CAL_populares_at_row2 }
	add_to_variable = { CAL_seats_drawn	= CAL_populares_at_row3 }
	add_to_variable = { CAL_seats_drawn	= CAL_populares_at_row4 }
	add_to_variable = { CAL_seats_drawn	= CAL_populares_at_row5 }
	if = {
		limit = {
			check_variable = {
				var = CAL_seats_drawn
				value = CAL_populares_count
				compare = not_equals
			}
			check_variable = {
				CAL_senate_lvl = 1
			}
		}
		log= "[?CAL_seats_drawn] = [?CAL_populares_count]??? GUH???"
	}
	add_to_variable = { CAL_seats_drawn	= CAL_populares_at_row6 }
	if = {
		limit = {
			check_variable = {
				var = CAL_seats_drawn
				value = CAL_populares_count
				compare = not_equals
			}
			check_variable = {
				CAL_senate_lvl = 2
			}
		}
		log= "[?CAL_seats_drawn] = [?CAL_populares_count]??? GUH???"
	}
	add_to_variable = { CAL_seats_drawn	= CAL_populares_at_row7 }
	add_to_variable = { CAL_seats_drawn	= CAL_populares_at_row8 }
	add_to_variable = { CAL_seats_drawn	= CAL_populares_at_row9 }
	add_to_variable = { CAL_seats_drawn	= CAL_populares_at_row10 }
	if = {
		limit = {
			check_variable = {
				var = CAL_seats_drawn
				value = CAL_populares_count
				compare = not_equals
			}
			check_variable = {
				CAL_senate_lvl = 3
			}
		}
		log= "[?CAL_seats_drawn] = [?CAL_populares_count]??? GUH???"
	}
	add_to_variable = { CAL_seats_drawn	= CAL_populares_at_row11 }
	add_to_variable = { CAL_seats_drawn	= CAL_populares_at_row12 }
	add_to_variable = { CAL_seats_drawn	= CAL_populares_at_row13 }
	add_to_variable = { CAL_seats_drawn	= CAL_populares_at_row14 }
	add_to_variable = { CAL_seats_drawn	= CAL_populares_at_row15 }
	add_to_variable = { CAL_seats_drawn	= CAL_populares_at_row16 }
	add_to_variable = { CAL_seats_drawn	= CAL_populares_at_row17 }
	add_to_variable = { CAL_seats_drawn	= CAL_populares_at_row18 }
	add_to_variable = { CAL_seats_drawn	= CAL_populares_at_row19 }
	if = {
		limit = {
			check_variable = {
				var = CAL_seats_drawn
				value = CAL_populares_count
				compare = not_equals
			}
			check_variable = {
				CAL_senate_lvl = 4
			}
		}
		log= "[?CAL_seats_drawn] = [?CAL_populares_count]??? GUH???"
	}
}

CAL_initiate_senate_vote_populares = {
	set_variable = {
		var = CAL_total_senators
		value = CAL_populares_count
	}
	add_to_variable = {
		var = CAL_total_senators
		value = CAL_optimates_count
	}

	#############
	# Populares #
	#############

	# Yes
	set_variable = {
		var = CAL_populares_moving_yes
		value = CAL_populares_count
	}
	multiply_variable = {
		var = CAL_populares_moving_yes
		value = 0.3
	}
	round_variable = CAL_populares_moving_yes
	set_variable = {
		var = CAL_populares_yes
		value = CAL_populares_moving_yes
	}
	# No
	set_variable = {
		var = CAL_populares_moving_no
		value = CAL_populares_count
	}
	multiply_variable = {
		var = CAL_populares_moving_no
		value = 0.7
	}
	round_variable = CAL_populares_moving_no
	set_variable = {
		var = CAL_populares_no
		value = CAL_populares_moving_no
	}

	#############
	# Optimates #
	#############

	# Yes
	set_variable = {
		var = CAL_optimates_moving_yes
		value = CAL_optimates_count
	}
	multiply_variable = {
		var = CAL_optimates_moving_yes
		value = 0.1
	}
	round_variable = CAL_optimates_moving_yes
	set_variable = {
		var = CAL_optimates_yes
		value = CAL_optimates_moving_yes
	}
	# No
	set_variable = {
		var = CAL_optimates_moving_no
		value = CAL_optimates_count
	}
	multiply_variable = {
		var = CAL_optimates_moving_no
		value = 0.9
	}
	round_variable = CAL_optimates_moving_no
	set_variable = {
		var = CAL_optimates_no
		value = CAL_optimates_moving_no
	}
}

CAL_initiate_senate_vote_optimates = {
	set_variable = {
		var = CAL_total_senators
		value = CAL_populares_count
	}
	add_to_variable = {
		var = CAL_total_senators
		value = CAL_optimates_count
	}

	#############
	# Populares #
	#############

	# Yes
	set_variable = {
		var = CAL_populares_moving_yes
		value = CAL_populares_count
	}
	multiply_variable = {
		var = CAL_populares_moving_yes
		value = 0.1
	}
	round_variable = CAL_populares_moving_yes
	set_variable = {
		var = CAL_populares_yes
		value = CAL_populares_moving_yes
	}
	# No
	set_variable = {
		var = CAL_populares_moving_no
		value = CAL_populares_count
	}
	multiply_variable = {
		var = CAL_populares_moving_no
		value = 0.9
	}
	round_variable = CAL_populares_moving_no
	set_variable = {
		var = CAL_populares_no
		value = CAL_populares_moving_no
	}

	#############
	# Optimates #
	#############

	# Yes
	set_variable = {
		var = CAL_optimates_moving_yes
		value = CAL_optimates_count
	}
	multiply_variable = {
		var = CAL_optimates_moving_yes
		value = 0.3
	}
	round_variable = CAL_optimates_moving_yes
	set_variable = {
		var = CAL_optimates_yes
		value = CAL_optimates_moving_yes
	}
	# No
	set_variable = {
		var = CAL_optimates_moving_no
		value = CAL_optimates_count
	}
	multiply_variable = {
		var = CAL_optimates_moving_no
		value = 0.7
	}
	round_variable = CAL_optimates_moving_no
	set_variable = {
		var = CAL_optimates_no
		value = CAL_optimates_moving_no
	}
}

CAL_senate_fix_no = {
    subtract_from_variable = {
        var = CAL_optimates_no
        value = CAL_optimates_moving_yes
    }
    subtract_from_variable = {
        var = CAL_populares_no
        value = CAL_populares_moving_yes
    }
}

CAL_senate_fix_yes = {
    subtract_from_variable = {
        var = CAL_populares_yes
        value = CAL_populares_moving_no
    }
    subtract_from_variable = {
        var = CAL_populares_yes
        value = CAL_populares_moving_no
    }
}

CAL_senators_halved_voting = {
	set_variable = {
		var = CAL_total_senators
		value = CAL_populares_count
	}
	add_to_variable = {
		var = CAL_total_senators
		value = CAL_optimates_count
	}
	multiply_variable = {
		var = CAL_total_senators
		value = 0.5
	}
}

CAL_count_yes_and_no = {
	set_variable = {
		var = CAL_all_yes_show
		value = CAL_populares_yes
	}
	add_to_variable = {
		var = CAL_all_yes_show
		value = CAL_optimates_yes
	}
	set_variable = {
		var = CAL_all_no_show
		value = CAL_populares_no
	}
	add_to_variable = {
		var = CAL_all_no_show
		value = CAL_optimates_no
	}
}

CAL_senate_voting_result = {
	custom_effect_tooltip = CAL_votes_show_tt

	CAL_senators_halved_voting = yes

	#############
	# POPULARZY #
	#############

	if = {
		limit = {
			has_country_flag = CAL_populares_lex_voting
		}
		if = {
			limit = {
				CAL_yes_senators_count = yes
			}
			#AGER PUBLICUS
			if = {
				limit = {
					has_country_flag = CAL_ager_publicus_vote
				}
				#Nić xd
			}
			#LEX TRIBUTORUM
			if = {
				limit = {
					has_country_flag = CAL_lex_tributorum_vote
				}
				### PRAWO POPULARÓW
				add_to_variable = {
					var = CAL_populares_loyalty
					value = 5
					tooltip = CAL_change_loyalty_populares_tt
				}
				add_to_variable = {
					var = CAL_optimates_loyalty
					value = -10
					tooltip = CAL_change_loyalty_optimates_tt
				}
			}
		}
		else = {
			#AGER PUBLICUS
			if = {
				limit = {
					has_country_flag = CAL_ager_publicus_vote
				}
				custom_effect_tooltip = CAL_ager_publicus_populares_fails_tt
				hidden_effect = {
					clr_country_flag = CAL_populares_lex_voting
					clr_country_flag = CAL_ager_publicus_vote
					set_country_flag = CAL_ager_publicus_failed
				}
			}
			#LEX TRIBUTORUM
			if = {
				limit = {
					has_country_flag = CAL_lex_tributorum_vote
				}
				### PRAWO OPTYMATÓW
				add_to_variable = {
					var = CAL_populares_loyalty
					value = -15
					tooltip = CAL_change_loyalty_populares_tt
				}
				add_to_variable = {
					var = CAL_optimates_loyalty
					value = -5
					tooltip = CAL_change_loyalty_optimates_tt
				}
			}
		}
	}

	############
	# OPTYMACI #
	############

	else_if = {
		limit = {
			has_country_flag = CAL_optimates_lex_voting
		}
		if = {
			limit = {
				CAL_yes_senators_count = yes
			}
			#AGER PUBLICUS
			if = {
				limit = {
					has_country_flag = CAL_ager_publicus_vote
				}
				#Nić xd
			}
			#LEX TRIBUTORUM
			if = {
				limit = {
					has_country_flag = CAL_lex_tributorum_vote
				}
				### PRAWO OPTYMATÓW
				add_to_variable = {
					var = CAL_optimates_loyalty
					value = 5
					tooltip = CAL_change_loyalty_optimates_tt
				}
				add_to_variable = {
					var = CAL_populares_loyalty
					value = -10
					tooltip = CAL_change_loyalty_populares_tt
				}
			}
		}
		else = {
			#AGER PUBLICUS
			if = {
				limit = {
					has_country_flag = CAL_ager_publicus_vote
				}
				custom_effect_tooltip = CAL_ager_publicus_optimates_fails_tt
				hidden_effect = {
					clr_country_flag = CAL_optimates_lex_voting
					clr_country_flag = CAL_ager_publicus_vote
					set_country_flag = CAL_ager_publicus_failed
				}
			}
			#LEX TRIBUTORUM
			if = {
				limit = {
					has_country_flag = CAL_lex_tributorum_vote
				}
				### PRAWO POPULARÓW
				add_to_variable = {
					var = CAL_optimates_loyalty
					value = -15
					tooltip = CAL_change_loyalty_optimates_tt
				}
				add_to_variable = {
					var = CAL_populares_loyalty
					value = -5
					tooltip = CAL_change_loyalty_populares_tt
				}
			}
		}
	}
}